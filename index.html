<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Porte-√†-Porte</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <div id="app" class="p-6"></div>

  <script>
    // ‚ö° Configuration Supabase
    const SUPABASE_URL = "https://trnquwaidbxjzfrisdnu.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRybnF1d2FpZGJ4anpmcmlzZG51Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NzMyMTIsImV4cCI6MjA3MzU0OTIxMn0.uvpkuzw0JzQPj53hNlU4d0Db-TIvnfdVzBtkvhsMZhM";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // V√©rifie si l'utilisateur est connect√©
    async function checkAuth() {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        // ‚ö° Si pas connect√© ‚Üí redirection vers login.html
        window.location.href = "login.html";
      } else {
        renderApp(session.user);
      }
    }

    // ‚ö° Affiche l'application si connect√©
    function renderApp(user) {
      document.getElementById("app").innerHTML = `
        <div class="flex justify-between items-center mb-6">
          <h1 class="text-2xl font-bold">üìã Porte-√†-Porte</h1>
          <div class="flex items-center space-x-4">
            <span>Connect√© : <b>${user.email}</b></span>
            <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded">Se d√©connecter</button>
          </div>
        </div>

        <div class="mb-4">
          <label class="block mb-2 font-semibold">Importer un fichier CSV :</label>
          <input type="file" id="csvFile" accept=".csv" class="border p-2" onchange="loadCSV(event)" />
        </div>

        <div class="overflow-x-auto">
          <table id="dataTable" class="min-w-full border border-gray-300 bg-white">
            <thead class="bg-gray-200">
              <tr>
                <th class="border px-4 py-2">Nom</th>
                <th class="border px-4 py-2">Pr√©nom</th>
                <th class="border px-4 py-2">Bureau</th>
                <th class="border px-4 py-2">Adresse</th>
                <th class="border px-4 py-2">Email</th>
                <th class="border px-4 py-2">T√©l√©phone</th>
                <th class="border px-4 py-2">Remarque</th>
                <th class="border px-4 py-2">Statut</th>
                <th class="border px-4 py-2">Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      `;
    }

    // D√©connexion
    async function logout() {
      await supabase.auth.signOut();
      window.location.href = "login.html";
    }

    // Charger un CSV
    function loadCSV(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        const text = e.target.result;
        parseCSV(text);
      };
      reader.readAsText(file);
    }

    // Parser CSV simple
    function parseCSV(text) {
      const rows = text.split("\n").map(r => r.split(","));
      const tbody = document.querySelector("#dataTable tbody");
      tbody.innerHTML = "";

      rows.slice(1).forEach(row => {
        if (row.length < 2) return;
        const tr = document.createElement("tr");
        row.forEach(cell => {
          const td = document.createElement("td");
          td.classList.add("border", "px-4", "py-2");
          td.textContent = cell.trim();
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    // ‚ö° Lancer la v√©rification
    checkAuth();
  </script>
</body>
</html>
